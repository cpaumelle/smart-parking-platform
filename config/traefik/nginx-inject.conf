events {
    worker_connections 1024;
}

http {
    include /etc/nginx/mime.types;
    default_type application/octet-stream;
    
    server {
        listen 8081;
        
        # Serve static files
        location = /mobile-menu.js {
            root /etc/nginx/static;
            add_header Content-Type application/javascript;
            add_header Cache-Control "no-cache";
        }
        
        location / {
            proxy_pass http://parking-chirpstack:8080;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;
            
            # Enable HTML substitution
            sub_filter_types text/html;
            sub_filter_once on;
            
            # Inject mobile responsive CSS and script before </head>
            sub_filter '</head>' '<style>/* ChirpStack Mobile Responsive CSS */.mobile-menu-toggle{display:none;position:fixed;top:16px;left:16px;z-index:2000;background:#1890ff;border:none;border-radius:4px;width:44px;height:44px;cursor:pointer;box-shadow:0 2px 8px rgba(0,0,0,0.15);padding:0}.mobile-menu-toggle span{display:block;width:22px;height:2px;background:white;margin:4px auto;transition:0.3s;border-radius:2px}.mobile-menu-toggle.active span:nth-child(1){transform:rotate(-45deg) translate(-5px,5px)}.mobile-menu-toggle.active span:nth-child(2){opacity:0}.mobile-menu-toggle.active span:nth-child(3){transform:rotate(45deg) translate(-5px,-5px)}.sidebar-overlay{display:none;position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.5);z-index:1500}@media(max-width:768px){.mobile-menu-toggle{display:flex;align-items:center;justify-content:center}.ant-layout-sider{position:fixed!important;left:-280px!important;top:0!important;bottom:0!important;z-index:1600!important;height:100vh!important;transition:left 0.3s ease-in-out!important;box-shadow:2px 0 8px rgba(0,0,0,0.15)!important}.ant-layout-sider.mobile-menu-open{left:0!important}.sidebar-overlay.active{display:block}.ant-layout-content{margin-left:0!important;padding-top:60px!important}.ant-layout,.ant-layout-content,.ant-table-wrapper,body{min-width:unset!important;width:100%!important}.ant-table{overflow-x:auto!important;display:block!important}.ant-table-wrapper{overflow-x:auto!important}.ant-form,.ant-card,.ant-modal{max-width:100%!important;margin:0!important}.ant-btn{padding:10px 14px!important;font-size:14px!important;min-height:36px!important}body{font-size:14px!important}h1{font-size:22px!important}h2{font-size:18px!important}h3{font-size:16px!important}.ant-menu{font-size:14px!important}.ant-layout-content{padding:12px!important}.ant-input,.ant-select,.ant-picker{font-size:16px!important;min-height:44px!important}.ant-pagination{font-size:12px!important}.ant-pagination-item{min-width:32px!important;height:32px!important}.ant-modal{margin:8px!important;max-width:calc(100vw - 16px)!important}.ant-card-body{padding:12px!important}}@media(max-width:480px){body{font-size:13px!important}.ant-btn{padding:8px 12px!important;font-size:13px!important}.ant-layout-content{padding:8px!important}h1{font-size:20px!important}h2{font-size:16px!important}h3{font-size:14px!important}}@media(hover:none)and (pointer:coarse){.ant-btn,.ant-menu-item,.ant-list-item,.ant-table-row,a{min-height:44px!important;display:flex!important;align-items:center!important}}</style><script src="/mobile-menu.js"></script></head>';
        }
    }
}
